// ----------------------------------------------------------------------------
// Buzz, a Javascript HTML5 Audio library
// v 1.0.6
// Licensed under the MIT license.
// http://buzz.jaysalvat.com/
// ----------------------------------------------------------------------------
// Copyright (C) 2013 Jay Salvat
// http://jaysalvat.com/
// ----------------------------------------------------------------------------
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files ( the "Software" ), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
// ----------------------------------------------------------------------------
var buzz={defaults:{autoplay:false,duration:5e3,formats:[],loop:false,placeholder:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(e,t){function o(e){var t=[],n=e.length-1;for(var r=0;r<=n;r++){t.push({start:e.start(n),end:e.end(n)})}return t}function u(e){return e.split(".").pop()}function a(e,t){var n=document.createElement("source");n.src=t;if(buzz.types[u(t)]){n.type=buzz.types[u(t)]}e.appendChild(n)}t=t||{};var n=0,r=[],i={},s=buzz.isSupported();this.load=function(){if(!s){return this}this.sound.load();return this};this.play=function(){if(!s){return this}this.sound.play();return this};this.togglePlay=function(){if(!s){return this}if(this.sound.paused){this.sound.play()}else{this.sound.pause()}return this};this.pause=function(){if(!s){return this}this.sound.pause();return this};this.isPaused=function(){if(!s){return null}return this.sound.paused};this.stop=function(){if(!s){return this}this.setTime(0);this.sound.pause();return this};this.isEnded=function(){if(!s){return null}return this.sound.ended};this.loop=function(){if(!s){return this}this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!s){return this}this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!s){return this}this.sound.muted=true;return this};this.unmute=function(){if(!s){return this}this.sound.muted=false;return this};this.toggleMute=function(){if(!s){return this}this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){if(!s){return null}return this.sound.muted};this.setVolume=function(e){if(!s){return this}if(e<0){e=0}if(e>100){e=100}this.volume=e;this.sound.volume=e/100;return this};this.getVolume=function(){if(!s){return this}return this.volume};this.increaseVolume=function(e){return this.setVolume(this.volume+(e||1))};this.decreaseVolume=function(e){return this.setVolume(this.volume-(e||1))};this.setTime=function(e){if(!s){return this}this.whenReady(function(){this.sound.currentTime=e});return this};this.getTime=function(){if(!s){return null}var e=Math.round(this.sound.currentTime*100)/100;return isNaN(e)?buzz.defaults.placeholder:e};this.setPercent=function(e){if(!s){return this}return this.setTime(buzz.fromPercent(e,this.sound.duration))};this.getPercent=function(){if(!s){return null}var e=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(e)?buzz.defaults.placeholder:e};this.setSpeed=function(e){if(!s){return this}this.sound.playbackRate=e};this.getSpeed=function(){if(!s){return null}return this.sound.playbackRate};this.getDuration=function(){if(!s){return null}var e=Math.round(this.sound.duration*100)/100;return isNaN(e)?buzz.defaults.placeholder:e};this.getPlayed=function(){if(!s){return null}return o(this.sound.played)};this.getBuffered=function(){if(!s){return null}return o(this.sound.buffered)};this.getSeekable=function(){if(!s){return null}return o(this.sound.seekable)};this.getErrorCode=function(){if(s&&this.sound.error){return this.sound.error.code}return 0};this.getErrorMessage=function(){if(!s){return null}switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){if(!s){return null}return this.sound.readyState};this.getStateMessage=function(){if(!s){return null}switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){if(!s){return null}return this.sound.networkState};this.getNetworkStateMessage=function(){if(!s){return null}switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(e,t){if(!s){return this}this.sound[e]=t;return this};this.get=function(e){if(!s){return null}return e?this.sound[e]:this.sound};this.bind=function(e,t){if(!s){return this}e=e.split(" ");var n=this,i=function(e){t.call(n,e)};for(var o=0;o<e.length;o++){var u=e[o],a=u;u=a.split(".")[0];r.push({idx:a,func:i});this.sound.addEventListener(u,i,true)}return this};this.unbind=function(e){if(!s){return this}e=e.split(" ");for(var t=0;t<e.length;t++){var n=e[t],i=n.split(".")[0];for(var o=0;o<r.length;o++){var u=r[o].idx.split(".");if(r[o].idx==n||u[1]&&u[1]==n.replace(".","")){this.sound.removeEventListener(i,r[o].func,true);r.splice(o,1)}}}return this};this.bindOnce=function(e,t){if(!s){return this}var r=this;i[n++]=false;this.bind(e+"."+n,function(){if(!i[n]){i[n]=true;t.call(r)}r.unbind(e+"."+n)})};this.trigger=function(e){if(!s){return this}e=e.split(" ");for(var t=0;t<e.length;t++){var n=e[t];for(var i=0;i<r.length;i++){var o=r[i].idx.split(".");if(r[i].idx==n||o[0]&&o[0]==n.replace(".","")){var u=document.createEvent("HTMLEvents");u.initEvent(o[0],false,true);this.sound.dispatchEvent(u)}}}return this};this.fadeTo=function(e,t,n){function u(){setTimeout(function(){if(r<e&&o.volume<e){o.setVolume(o.volume+=1);u()}else if(r>e&&o.volume>e){o.setVolume(o.volume-=1);u()}else if(n instanceof Function){n.apply(o)}},i)}if(!s){return this}if(t instanceof Function){n=t;t=buzz.defaults.duration}else{t=t||buzz.defaults.duration}var r=this.volume,i=t/Math.abs(r-e),o=this;this.play();this.whenReady(function(){u()});return this};this.fadeIn=function(e,t){if(!s){return this}return this.setVolume(0).fadeTo(100,e,t)};this.fadeOut=function(e,t){if(!s){return this}return this.fadeTo(0,e,t)};this.fadeWith=function(e,t){if(!s){return this}this.fadeOut(t,function(){this.stop()});e.play().fadeIn(t);return this};this.whenReady=function(e){if(!s){return null}var t=this;if(this.sound.readyState===0){this.bind("canplay.buzzwhenready",function(){e.call(t)})}else{e.call(t)}};if(s&&e){for(var f in buzz.defaults){if(buzz.defaults.hasOwnProperty(f)){t[f]=t[f]||buzz.defaults[f]}}this.sound=document.createElement("audio");if(e instanceof Array){for(var l in e){if(e.hasOwnProperty(l)){a(this.sound,e[l])}}}else if(t.formats.length){for(var c in t.formats){if(t.formats.hasOwnProperty(c)){a(this.sound,e+"."+t.formats[c])}}}else{a(this.sound,e)}if(t.loop){this.loop()}if(t.autoplay){this.sound.autoplay="autoplay"}if(t.preload===true){this.sound.preload="auto"}else if(t.preload===false){this.sound.preload="none"}else{this.sound.preload=t.preload}this.setVolume(t.volume);buzz.sounds.push(this)}},group:function(e){function t(){var t=n(null,arguments),r=t.shift();for(var i=0;i<e.length;i++){e[i][r].apply(e[i],t)}}function n(e,t){return e instanceof Array?e:Array.prototype.slice.call(t)}e=n(e,arguments);this.getSounds=function(){return e};this.add=function(t){t=n(t,arguments);for(var r=0;r<t.length;r++){e.push(t[r])}};this.remove=function(t){t=n(t,arguments);for(var r=0;r<t.length;r++){for(var i=0;i<e.length;i++){if(e[i]==t[r]){e.splice(i,1);break}}}};this.load=function(){t("load");return this};this.play=function(){t("play");return this};this.togglePlay=function(){t("togglePlay");return this};this.pause=function(e){t("pause",e);return this};this.stop=function(){t("stop");return this};this.mute=function(){t("mute");return this};this.unmute=function(){t("unmute");return this};this.toggleMute=function(){t("toggleMute");return this};this.setVolume=function(e){t("setVolume",e);return this};this.increaseVolume=function(e){t("increaseVolume",e);return this};this.decreaseVolume=function(e){t("decreaseVolume",e);return this};this.loop=function(){t("loop");return this};this.unloop=function(){t("unloop");return this};this.setTime=function(e){t("setTime",e);return this};this.set=function(e,n){t("set",e,n);return this};this.bind=function(e,n){t("bind",e,n);return this};this.unbind=function(e){t("unbind",e);return this};this.bindOnce=function(e,n){t("bindOnce",e,n);return this};this.trigger=function(e){t("trigger",e);return this};this.fade=function(e,n,r,i){t("fade",e,n,r,i);return this};this.fadeIn=function(e,n){t("fadeIn",e,n);return this};this.fadeOut=function(e,n){t("fadeOut",e,n);return this}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return!!buzz.el.canPlayType},isOGGSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(e,t){var n,r,i;n=Math.floor(e/3600);n=isNaN(n)?"--":n>=10?n:"0"+n;r=t?Math.floor(e/60%60):Math.floor(e/60);r=isNaN(r)?"--":r>=10?r:"0"+r;i=Math.floor(e%60);i=isNaN(i)?"--":i>=10?i:"0"+i;return t?n+":"+r+":"+i:r+":"+i},fromTimer:function(e){var t=e.toString().split(":");if(t&&t.length==3){e=parseInt(t[0],10)*3600+parseInt(t[1],10)*60+parseInt(t[2],10)}if(t&&t.length==2){e=parseInt(t[0],10)*60+parseInt(t[1],10)}return e},toPercent:function(e,t,n){var r=Math.pow(10,n||0);return Math.round(e*100/t*r)/r},fromPercent:function(e,t,n){var r=Math.pow(10,n||0);return Math.round(t/100*e*r)/r}}